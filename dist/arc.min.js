"use strict";var D2R=Math.PI/180,R2D=180/Math.PI,Coord=function(a,b){this.lon=a,this.lat=b,this.x=D2R*a,this.y=D2R*b};Coord.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},Coord.prototype.antipode=function(){var a=-1*this.lat,b=this.lon<0?180+this.lon:-1*(180-this.lon);return new Coord(b,a)};var LineString=function(){this.coords=[],this.length=0};LineString.prototype.move_to=function(a){this.length++,this.coords.push(a)};var Arc=function(a){this.properties=a||{},this.geometries=[]};Arc.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1==this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var a=[],b=0;b<this.geometries.length;b++)a.push(this.geometries[b].coords);return{geometry:{type:"MultiLineString",coordinates:a},type:"Feature",properties:this.properties}},Arc.prototype.wkt=function(){for(var a="",b="LINESTRING(",c=function(a){b+=a[0]+" "+a[1]+","},d=0;d<this.geometries.length;d++){if(0===this.geometries[d].coords.length)return"LINESTRING(empty)";var e=this.geometries[d].coords;e.forEach(c),a+=b.substring(0,b.length-1)+")"}return a};var GreatCircle=function(a,b,c){if(!a||void 0===a.x||void 0===a.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!b||void 0===b.x||void 0===b.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Coord(a.x,a.y),this.end=new Coord(b.x,b.y),this.properties=c||{};var d=this.start.x-this.end.x,e=this.start.y-this.end.y,f=Math.pow(Math.sin(e/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(d/2),2);if(this.g=2*Math.asin(Math.sqrt(f)),this.g==Math.PI)throw new Error("it appears "+a.view()+" and "+b.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+a+" and "+b)};if(GreatCircle.prototype.interpolate=function(a){var b=Math.sin((1-a)*this.g)/Math.sin(this.g),c=Math.sin(a*this.g)/Math.sin(this.g),d=b*Math.cos(this.start.y)*Math.cos(this.start.x)+c*Math.cos(this.end.y)*Math.cos(this.end.x),e=b*Math.cos(this.start.y)*Math.sin(this.start.x)+c*Math.cos(this.end.y)*Math.sin(this.end.x),f=b*Math.sin(this.start.y)+c*Math.sin(this.end.y),g=R2D*Math.atan2(f,Math.sqrt(Math.pow(d,2)+Math.pow(e,2))),h=R2D*Math.atan2(e,d);return[h,g]},GreatCircle.prototype.Arc=function(a,b){var c=[];if(!a||2>=a)c.push([this.start.lon,this.start.lat]),c.push([this.end.lon,this.end.lat]);else for(var d=1/(a-1),e=0;a>e;++e){var f=d*e,g=this.interpolate(f);c.push(g)}for(var h=!1,i=0,j=b&&b.offset?b.offset:10,k=180-j,l=-180+j,m=360-j,n=1;n<c.length;++n){var o=c[n-1][0],p=c[n][0],q=Math.abs(p-o);q>m&&(p>k&&l>o||o>k&&l>p)?h=!0:q>i&&(i=q)}var r=[];if(h&&j>i){var s=[];r.push(s);for(var t=0;t<c.length;++t){var u=parseFloat(c[t][0]);if(t>0&&Math.abs(u-c[t-1][0])>m){var v=parseFloat(c[t-1][0]),w=parseFloat(c[t-1][1]),x=parseFloat(c[t][0]),y=parseFloat(c[t][1]);if(v>-180&&l>v&&180==x&&t+1<c.length&&c[t-1][0]>-180&&c[t-1][0]<l){s.push([-180,c[t][1]]),t++,s.push([c[t][0],c[t][1]]);continue}if(v>k&&180>v&&-180==x&&t+1<c.length&&c[t-1][0]>k&&c[t-1][0]<180){s.push([180,c[t][1]]),t++,s.push([c[t][0],c[t][1]]);continue}if(l>v&&x>k){var z=v;v=x,x=z;var A=w;w=y,y=A}if(v>k&&l>x&&(x+=360),180>=v&&x>=180&&x>v){var B=(180-v)/(x-v),C=B*y+(1-B)*w;s.push([c[t-1][0]>k?180:-180,C]),s=[],s.push([c[t-1][0]>k?-180:180,C]),r.push(s)}else s=[],r.push(s);s.push([u,c[t][1]])}else s.push([c[t][0],c[t][1]])}}else{var D=[];r.push(D);for(var E=0;E<c.length;++E)D.push([c[E][0],c[E][1]])}for(var F=new Arc(this.properties),G=0;G<r.length;++G){var H=new LineString;F.geometries.push(H);for(var I=r[G],J=0;J<I.length;++J)H.move_to(I[J])}return F},"undefined"==typeof window)module.exports.Coord=Coord,module.exports.Arc=Arc,module.exports.GreatCircle=GreatCircle;else{var arc={};arc.Coord=Coord,arc.Arc=Arc,arc.GreatCircle=GreatCircle}